services:
  receiver:
    build: .
    image: game-net-api
    networks: [quicnet]
    command: ["python", "receiverExample.py"]
    environment:
      - HOST=receiver
      - PORT=4433

  sender:
    image: game-net-api
    depends_on: [receiver]
    networks: [quicnet]
    stdin_open: true
    tty: true
    command: ["python", "senderExample.py"]
    environment:
      - HOST=receiver
      - PORT=4433

  # Interactive REPL client with shaping (latency/loss/jitter/bw)
  sender-slow:
    image: game-net-api
    depends_on: [receiver]
    networks: [quicnet]
    stdin_open: true
    tty: true
    cap_add: ["NET_ADMIN"]   # allow tc
    command:
      - bash
      - -lc
      - >
        tc qdisc add dev eth0 root netem delay 120ms 40ms loss 50% rate 8mbit ;
        python senderExample.py ;
        tc qdisc del dev eth0 root || true
    environment:
      - HOST=receiver
      - PORT=4433

networks:
  quicnet:
    driver: bridge
